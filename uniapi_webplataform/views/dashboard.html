<!DOCTYPE html>
<html lang="en">
  <head>
	<link href="http://www.iconarchive.com/download/i83014/designbolts/handstitch-social/Cloud.ico" rel="icon" >
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>UniApi-Dashboard</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
	
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" href="/css/dashboard.css"/>
	<style>
		.principal{
			margin-top: 10px;
			margin-bottom: 10px;
		}
		.perfil{
			width:70px;
			high:70px;
		}
		.carga{
			border:groove 2px;
		}
		.typeActive{
			border: groove blue;
		}
		.noPulse{
			display:block;
		}
		.mainInfo textarea{
			border:0;
		}
		.secondaryInfo input{
			border:0;
		}
		.secondaryInfo textarea{
			border:0;
		}
		
	</style>
  </head>
<body ng-app="menuApp">

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<a class="navbar-brand" style="padding-left:50%;font-family: 'Anton', sans-serif;font-size:22px;" href="#/"><span style="padding-right:10px" class="glyphicon glyphicon-cloud"></span><span>UniApi</span></a>
       		 </div>
    </nav>
	<!-- The Modal -->
	<div id="myModal" class="modal">
	  <!-- Modal content -->
	  <div class="modal-content">
	  	<img src="resource/img/carga.gif" style="padding-left:45%">
		<h4 class="text-center">We are loading the initial data. Wait please...</h4>
	  </div>
	</div>

    <div class="container-fluid" id="page" style="display:none">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
			<div class="principal text-center">
				<img class="perfil img-circle" width="70" high="70" id="perfil" src="resource/img/perfil.jpg" />
				<h5 id="userName">user@user.com</h5>
				<span class="text-muted" style="font-size:10px" id="completeName">User subname1 subname2</span>
				<hr style="margin-bottom: 5px;"></hr>
				<button class="btn btn-default btn-sm">Log out</button>
			</div>
          <ul class="nav nav-sidebar">
            <li><a href="#/">Home page <span class="sr-only">(current)</span></a></li>
            <li><a href="#Groups">Grupos</a></li>
            <li><a href="#Projects">Proyectos</a></li>
            <li><a href="#Config">Configuraci√≥n</a></li>
	    <li><a href="#Admin">Administration</a></li>
	  </ul>
          <ul class="nav nav-sidebar">
            <li><a href="#NewProject">Nuevo proyecto</a></li>
            <li><a href="#NewGroup">Nuevo grupo</a></li>
          </ul>
        </div>

	</div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main" ng-view>

          


          
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- Just to make our placeholder images work. Don't actually copy the next line! -->
	<script src="https://getbootstrap.com/assets/js/vendor/holder.min.js"></script>
	<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	<script src="https://getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script>
	<script src="js/domainApp.js"></script>

	<script>
		// Get the modal
		var modal = document.getElementById('myModal');

		// Get the button that opens the modal
		var btn = document.getElementById("myBtn");

		// Get the <span> element that closes the modal
		var span = document.getElementsByClassName("close")[0];

		$(document).ready(function(){
			$("#page").css("display","none");			
			modal.style.display = "block";
			loggin();
		});
		
		function loggin(){
			var tokenSession=localStorage.getItem("tokenSession");

			if(tokenSession == null){
				window.location.href="loggin";
			}

			$.ajax({
				method:"GET",
				url:"http://localhost:8080/"+tokenSession+"/whoami"
			}).done(function(response){
				console.log(response);
				if(response.state != 0)
					window.location.href="loggin";
				modal.style.display = "none";
				$("#page").css("display","block");
				$("#perfil").attr("src",response.person.profileImageUrl);
				$("#completeName").text(response.person.name+" "+response.person.subname);
				$("#userName").text(response.userLogin.user);
			}).error(function(error){
				window.location.href="loggin";
			});

		}
		function sendNewProyect(proyecto){

			var tokenSession=localStorage.getItem("tokenSession");
			var data=JSON.stringify(proyecto);
			if(tokenSession == null)
				window.location.href="loggin";

			$.ajax({
				method:"POST",
				url:"http://localhost:8080/project/"+tokenSession+"/project",
				dataType: 'json',
				contentType: 'application/json',
				data: data
			}).done(function(response){
				console.log(response);
				if(response.state != 0){
					//window.location.href="loggin";
				}
			}).error(function(error){
				console.log(error);
				//window.location.href="/";
			});		
		}

		   
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-route.js"></script>

	<script>
	
		var app = angular.module('menuApp',["ngRoute"]);
		app.config(function($routeProvider) {
		    $routeProvider
		    .when("/", {
			templateUrl : "pages/main.htm"
			
		    })
		    .when("/Groups", {
			template : "<h1>Group:</h1>"
		    })
		    .when("/Projects", {
			templateUrl : "pages/listProject.htm",
			controller : "listProjectCtrl"
		    })
		    .when("/Config", {
			template : "<h1>Configuration:</h1>"
		    })
		    .when("/Admin", {
			template : "<h1>Administration:</h1>"
		    })
		    .when("/NewProject", {
			templateUrl : "pages/newProject.htm",
			controller : "newProjectCtrl"
		    })
		    .when("/NewGroup", {
			template : "<h1>New Group:</h1>"
		    });
		});

		app.controller("listProjectCtrl",function ($scope,$http){
			var tokenSession=localStorage.getItem("tokenSession");
			$http({
				method : "GET",
				url : "http://localhost:8080/project/"+tokenSession+"/project/all"
			}).then(function(response){
				console.log(response.data);
				$scope.projects=response.data.projects;
			});
			$scope.makeClick = function(id){
				console.log(id);
			};
		});

		app.controller("newProjectCtrl", function ($scope,$http) {
			$scope.clean = function(){
				
			};
			$scope.counter=0;
			$scope.addArgument = function(){
				$scope.counter++;
				$("#arrayDefaultInput").append("<li id='element_'"+$scope.counter+">["+$scope.counter+"]: <input id='value_"+$scope.counter+"' type='text'></li>");
			};
			$scope.removeArgument = function(){
				$("#arrayDefaultInput").children().get($scope.counter).remove();
				$scope.counter--;
			};
			$scope.makeSubmitDefaultInputs = function(){
				var response=new Array();
				if($scope.counter==0 && $("#value_"+0).val() == "")
					return response;
						
				for(var j=0;j<=$scope.counter;j++){
					response.push($("#value_"+j).val());
				}
				return response;
			};
			$scope.makeSubmit = function (){
				if($scope.type == null){
					alert("selecciona un tipo de proyecto");
					return;
				}
				var proyecto= new project("vacio",
							$scope.name, 
							$scope.type,
							$scope.description,
							$scope.gitRepositoryURL,
							$scope.email,
							$scope.password,
							new Date().getTime(),
							new Date().getTime(),
							$scope.mainName,
							$scope.responseName,
							//$scope.defaultInputs,
							$scope.makeSubmitDefaultInputs(),							
							$scope.inputDescription,
							$scope.outputDescription);
				console.log(proyecto);
				var anwser=sendNewProyect(proyecto);
			};
			$scope.clickType= function (type){
				$scope.type=type;
				switch(type){
					case 'PYTHON':
        					$("#pythonPick").addClass("typeActive");
						$("#javaPick").removeClass("typeActive");
						$("#octavePick").removeClass("typeActive");
						$("#rPick").removeClass("typeActive");
						$scope.type="PYTHON";
        				break;
					case 'JAVA':
        					$("#javaPick").addClass("typeActive");
						$("#pythonPick").removeClass("typeActive");
						$("#octavePick").removeClass("typeActive");
						$("#rPick").removeClass("typeActive");
						$scope.type="JAVA";        				
					break;
					case 'R':
        					$("#rPick").addClass("typeActive");
						$("#javaPick").removeClass("typeActive");
						$("#octavePick").removeClass("typeActive");
						$("#pythonPick").removeClass("typeActive");
						$scope.type="R";
        				break;
					case 'OCTAVE':
        					$("#octavePick").addClass("typeActive");
						$("#javaPick").removeClass("typeActive");
						$("#pythonPick").removeClass("typeActive");
						$("#rPick").removeClass("typeActive");
						$scope.type="OCTAVE";        				
					break;
    					default:
        					$("#pythonPick").removeClass("typeActive");
						$("#javaPick").removeClass("typeActive");
						$("#octavePick").removeClass("typeActive");
						$("#rPick").removeClass("typeActive");
			
				}
			}
		});
		
	</script>

  
  </body>
</html>
